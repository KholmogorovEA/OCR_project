                     ┌───────────────────┐
                     │   Пользователь    │
                     └─────────┬─────────┘
                               ▼
                  ┌───────────────────────────┐
                  │ Контекстная классификация │
                  │  (с примерами и динамич.  │
                  │         порогом)          │
                  └────────────┬──────────────┘
                               ▼
               ┌───────────────────────────────┐
               │  Выбор стратегии поиска:      │
               │  - Один retriever (если уверен)│
               │  - Ансамбль (если не уверен)  │
               └──────────────┬────────────────┘
                               ▼
                  ┌───────────────────────────┐
                  │ Гибридный поиск:          │
                  │ - Весовое комбинирование  │
                  │ - RRF-ранжирование        │
                  └────────────┬──────────────┘
                               ▼
                   ┌─────────────────────────┐
                   │ Юридический градер      │
                   │ (релевантность + юрисд.)│
                   └────────────┬────────────┘
                               ▼
                     ┌───────────────────┐
                     │  Финальный ответ  │
                     └───────────────────┘

Контекстно-зависимая классификация с примерами

Адаптивная система выбора retriever'ов

Продвинутое ранжирование с RRF

Юридически-ориентированная фильтрация

Оптимизация скорости через асинхронность